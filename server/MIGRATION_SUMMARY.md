# –ú—ñ–≥—Ä–∞—Ü—ñ—è –∑ LiqPay –Ω–∞ WayForPay - –ü—ñ–¥—Å—É–º–æ–∫

## ‚úÖ –í–∏–∫–æ–Ω–∞–Ω–æ

### üîÑ –ü–æ–≤–Ω–∞ –∑–∞–º—ñ–Ω–∞ –ø–ª–∞—Ç—ñ–∂–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏

**–í–∏–¥–∞–ª–µ–Ω–æ LiqPay:**
- ‚ùå server/utils/liqpay.js
- ‚ùå LIQPAY_INTEGRATION.md
- ‚ùå LIQPAY_REQUIREMENTS_CHECKLIST.md
- ‚ùå README_LIQPAY.md
- ‚ùå LiqPay SDK –∑ frontend

**–î–æ–¥–∞–Ω–æ WayForPay:**
- ‚úÖ server/utils/wayforpay.js - –ø–æ–≤–Ω–∏–π SDK
- ‚úÖ server/WAYFORPAY_INTEGRATION.md - –¥–µ—Ç–∞–ª—å–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è
- ‚úÖ –û–Ω–æ–≤–ª–µ–Ω–æ payment routes
- ‚úÖ –û–Ω–æ–≤–ª–µ–Ω–æ frontend —Ñ–æ—Ä–º–∏ –æ–ø–ª–∞—Ç–∏

## üì¶ –©–æ –∑–º—ñ–Ω–∏–ª–æ—Å—å

### Backend (server/)

**–ù–æ–≤–∏–π –º–æ–¥—É–ª—å: wayforpay.js**
```javascript
- –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è HMAC-MD5 –ø—ñ–¥–ø–∏—Å—É
- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–ª–∞—Ç–µ–∂—É –∑ —É—Å—ñ–º–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- –í–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è callback –≤—ñ–¥ WayForPay
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É –ø–ª–∞—Ç–µ–∂—É
- –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è HTML —Ñ–æ—Ä–º–∏ –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç—É
```

**–û–Ω–æ–≤–ª–µ–Ω–æ routes/payment.js:**
```javascript
POST /api/payment/create
- –ü—Ä–∏–π–º–∞—î –¥–∞–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
- –°—Ç–≤–æ—Ä—é—î –ø–ª–∞—Ç—ñ–∂ —á–µ—Ä–µ–∑ WayForPay
- –ü–æ–≤–µ—Ä—Ç–∞—î URL —Ç–∞ –¥–∞–Ω—ñ –¥–ª—è —Ñ–æ—Ä–º–∏

POST /api/payment/callback
- –û—Ç—Ä–∏–º—É—î callback –≤—ñ–¥ WayForPay
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î –ø—ñ–¥–ø–∏—Å (merchantSignature)
- –û–Ω–æ–≤–ª—é—î —Å—Ç–∞—Ç—É—Å –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
- –í—ñ–¥–ø—Ä–∞–≤–ª—è—î email —Ç–∞ Google Sheets
- –ü–æ–≤–µ—Ä—Ç–∞—î –ø—Ä–∞–≤–∏–ª—å–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å –¥–ª—è WayForPay
```

### Frontend (index.html)

**–ó–º—ñ–Ω–µ–Ω–æ –ª–æ–≥—ñ–∫—É –æ–ø–ª–∞—Ç–∏:**
```javascript
// –ë–£–õ–û (LiqPay):
LiqPayCheckout.init({
    data: base64Data,
    signature: sha1Signature,
    mode: "popup"
})

// –°–¢–ê–õ–û (WayForPay):
// –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ñ–æ—Ä–º–∏ –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π submit –Ω–∞ secure.wayforpay.com
form.submit()
```

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è (.env.example)

**–ó–º—ñ–Ω–µ–Ω–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏:**
```env
# –ë–£–õ–û:
LIQPAY_PUBLIC_KEY=xxx
LIQPAY_PRIVATE_KEY=xxx

# –°–¢–ê–õ–û:
WAYFORPAY_MERCHANT_ACCOUNT=xxx
WAYFORPAY_SECRET_KEY=xxx
MERCHANT_DOMAIN=yourdomain.com
```

## üîê –ü—ñ–¥–ø–∏—Å —Ç–∞ –±–µ–∑–ø–µ–∫–∞

### LiqPay (—Å—Ç–∞—Ä–∏–π —Å–ø–æ—Å—ñ–±):
- –ü—ñ–¥–ø–∏—Å: SHA1
- –§–æ—Ä–º–∞—Ç: private_key + base64(data) + private_key
- –ü–µ—Ä–µ–¥–∞—á–∞: data + signature –≤ base64

### WayForPay (–Ω–æ–≤–∏–π —Å–ø–æ—Å—ñ–±):
- –ü—ñ–¥–ø–∏—Å: HMAC-MD5
- –§–æ—Ä–º–∞—Ç: merchantAccount;domain;orderRef;date;amount;currency;products...
- –ü–µ—Ä–µ–¥–∞—á–∞: POST –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –≤ clear text –∑ merchantSignature

## üì± –ü—Ä–æ—Ü–µ—Å –æ–ø–ª–∞—Ç–∏

### –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á:
1. –ó–∞–ø–æ–≤–Ω—é—î —Ñ–æ—Ä–º—É –ø–µ—Ä–µ–¥–∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
2. –ù–∞—Ç–∏—Å–∫–∞—î "–û–ø–ª–∞—Ç–∏—Ç–∏"
3. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î—Ç—å—Å—è –Ω–∞ secure.wayforpay.com
4. –í–≤–æ–¥–∏—Ç—å –¥–∞–Ω—ñ –∫–∞—Ä—Ç–∫–∏
5. –ü–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –Ω–∞ success/error —Å—Ç–æ—Ä—ñ–Ω–∫—É

### –°–µ—Ä–≤–µ—Ä:
1. –°—Ç–≤–æ—Ä—é—î –ø–ª–∞—Ç—ñ–∂ (–≥–µ–Ω–µ—Ä—É—î signature)
2. –ü–æ–≤–µ—Ä—Ç–∞—î –¥–∞–Ω—ñ –¥–ª—è —Ñ–æ—Ä–º–∏
3. –û—Ç—Ä–∏–º—É—î callback –≤—ñ–¥ WayForPay
4. –ü–µ—Ä–µ–≤—ñ—Ä—è—î –ø—ñ–¥–ø–∏—Å
5. –û–Ω–æ–≤–ª—é—î —Å—Ç–∞—Ç—É—Å –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
6. –í—ñ–¥–ø—Ä–∞–≤–ª—è—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –¢–µ—Å—Ç–æ–≤—ñ –∫–∞—Ä—Ç–∫–∏ WayForPay:

**–£—Å–ø—ñ—à–Ω–∞ –æ–ø–ª–∞—Ç–∞:**
```
–ù–æ–º–µ—Ä: 4242 4242 4242 4242
CVV: –±—É–¥—å-—è–∫–∏–π
–î–∞—Ç–∞: –±—É–¥—å-—è–∫–∞ –º–∞–π–±—É—Ç–Ω—è
```

**–í—ñ–¥—Ö–∏–ª–µ–Ω–∞ –æ–ø–ª–∞—Ç–∞:**
```
–ù–æ–º–µ—Ä: 4000 0000 0000 0002
CVV: –±—É–¥—å-—è–∫–∏–π
–î–∞—Ç–∞: –±—É–¥—å-—è–∫–∞ –º–∞–π–±—É—Ç–Ω—è
```

## üìã –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏

### 1. –û—Ç—Ä–∏–º–∞—Ç–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ WayForPay

–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è –Ω–∞ https://wayforpay.com/:
- –ó–∞–ø–æ–≤–Ω–∏—Ç–∏ –∞–Ω–∫–µ—Ç—É
- –ù–∞–¥–∞—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏ (–Ü–ü–ù, –ø–∞—Å–ø–æ—Ä—Ç, –≤–∏–ø–∏—Å–∫–∞)
- –î–æ—á–µ–∫–∞—Ç–∏—Å—è –º–æ–¥–µ—Ä–∞—Ü—ñ—ó
- –û—Ç—Ä–∏–º–∞—Ç–∏ Merchant Account —Ç–∞ Secret Key

### 2. –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ .env –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ

```bash
ssh root@161.35.197.0
cd /var/www/mak/server
nano .env
```

–î–æ–¥–∞—Ç–∏:
```env
WAYFORPAY_MERCHANT_ACCOUNT=–≤–∞—à_merchant_account
WAYFORPAY_SECRET_KEY=–≤–∞—à_secret_key
MERCHANT_DOMAIN=xn--80aannbkklhueqiu2c5p.com
```

### 3. –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ URL —É –∫–∞–±—ñ–Ω–µ—Ç—ñ WayForPay

–í –æ—Å–æ–±–∏—Å—Ç–æ–º—É –∫–∞–±—ñ–Ω–µ—Ç—ñ WayForPay:
- **Service URL:** https://161.35.197.0/api/payment/callback
- **Return URL:** https://161.35.197.0/success

### 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä–≤–µ—Ä

```bash
cd /var/www/mak/server
pm2 restart mak-server
```

### 5. –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –æ–ø–ª–∞—Ç—É

1. –í—ñ–¥–∫—Ä–∏—Ç–∏ —Å–∞–π—Ç
2. –ó–∞–ø–æ–≤–Ω–∏—Ç–∏ —Ñ–æ—Ä–º—É –ø–µ—Ä–µ–¥–∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
3. –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Ç–µ—Å—Ç–æ–≤—É –∫–∞—Ä—Ç–∫—É
4. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ:
   - –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ WayForPay –ø—Ä–∞—Ü—é—î
   - Callback –ø—Ä–∏—Ö–æ–¥–∏—Ç—å
   - –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è
   - Email –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î—Ç—å—Å—è

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

–î–µ—Ç–∞–ª—å–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è –¥–æ—Å—Ç—É–ø–Ω–∞ –≤:
- **server/WAYFORPAY_INTEGRATION.md** - –ø–æ–≤–Ω–∏–π –≥–∞–π–¥ –ø–æ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó
- **server/.env.example** - –ø—Ä–∏–∫–ª–∞–¥ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
- **WayForPay Wiki:** https://wiki.wayforpay.com/

## ‚ö†Ô∏è –í–∞–∂–ª–∏–≤–æ

1. ‚úÖ –ü–µ—Ä–µ–¥ production –æ–±–æ–≤'—è–∑–∫–æ–≤–æ –ø—Ä–æ—Ç–µ—Å—Ç—É–π—Ç–µ –Ω–∞ staging
2. ‚úÖ –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è —â–æ HTTPS –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ
3. ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ callback URL –¥–æ—Å—Ç—É–ø–Ω–∏–π –∑ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É
4. ‚úÖ –ù—ñ–∫–æ–ª–∏ –Ω–µ –∫–æ–º—ñ—Ç—å—Ç–µ .env –∑ —Ä–µ–∞–ª—å–Ω–∏–º–∏ –∫–ª—é—á–∞–º–∏
5. ‚úÖ –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –¥–ª—è callback –ø–æ–º–∏–ª–æ–∫
6. ‚úÖ –†–µ–≥—É–ª—è—Ä–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –ª–æ–≥–∏ PM2

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

- ‚úÖ LiqPay –ø–æ–≤–Ω—ñ—Å—Ç—é –≤–∏–¥–∞–ª–µ–Ω–æ
- ‚úÖ WayForPay –ø–æ–≤–Ω—ñ—Å—Ç—é —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–æ
- ‚úÖ Backend –≥–æ—Ç–æ–≤–∏–π –¥–æ production
- ‚úÖ Frontend –≥–æ—Ç–æ–≤–∏–π –¥–æ production
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è —Å—Ç–≤–æ—Ä–µ–Ω–∞
- ‚úÖ –ö–æ–¥ —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –¥–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö WayForPay —Ç–∞ production —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è.

---

*–î–∞—Ç–∞ –º—ñ–≥—Ä–∞—Ü—ñ—ó: 27 –≥—Ä—É–¥–Ω—è 2025*
*–í–µ—Ä—Å—ñ—è: 1.0.0*
